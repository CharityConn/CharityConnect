<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<ts:token xmlns:ts="http://tokenscript.org/2024/01/tokenscript"
		  xmlns:xml="http://www.w3.org/XML/1998/namespace"
		  xsi:schemaLocation="http://tokenscript.org/2024/01/tokenscript https://www.tokenscript.org/schemas/2024-01/tokenscript.xsd"
		  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		  xmlns:ethereum="urn:ethereum:constantinople"
		  name="charityConnect">
	<ts:label>
		<ts:plurals xml:lang="en">
			<ts:string quantity="one">CharityConnect Token</ts:string>
			<ts:string quantity="other">CharityConnect Tokens</ts:string>
		</ts:plurals>
	</ts:label>
	<ts:meta>
		<ts:description xml:lang="en">This is your Charity Membership Card, represented as an ERC-721 NFT.</ts:description>
        <!-- Toggle these pair to build for production, but do not commit to version control -->
		<ts:aboutUrl xml:lang="en">https://d31vrfdo6b6g17.cloudfront.net/</ts:aboutUrl>
		<ts:iconUrl xml:lang="en">https://d31vrfdo6b6g17.cloudfront.net/assets/icon/cc/charity-connect-card.png</ts:iconUrl>
		<!--<ts:aboutUrl xml:lang="en">https://www.charityconnect.io/</ts:aboutUrl>-->
		<!--<ts:iconUrl xml:lang="en">https://www.charityconnect.io/assets/icon/cc/charity-connect-card.png</ts:iconUrl>-->
	</ts:meta>
    <!--Renaming `"Token"` to `"MembershipCard"` breaks filtering cards by origins. Don't do this without verifying cards are displayed correctly-->
    <!-- Toggle these 3 contracts+chains to build for production, but do not commit to version control -->
	<ts:contract interface="erc721" name="Token">
		<ts:address network="84532">0x40dc7D0B5E11Ee259314C548a238b9c909A4B721</ts:address>
	</ts:contract>
	<ts:contract interface="erc20" name="Points">
		<ts:address network="84532">0x6E651E97D10D330b761b1759DA88616c4764093d</ts:address>
	</ts:contract>
	<ts:contract name="DonationManager">
		<ts:address network="84532">0x87Aa0A8d5E560F413Eb7C1E860EC3741Ad5cb7DD</ts:address>

        <ts:abi>
            <![CDATA[
            [
                {
                    "constant": true,
                    "inputs": [],
                    "name": "getAllCharityNames",
                    "outputs": [
                        {
                            "name": "charityNames",
                            "type": "string[]"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                }
            ]
            ]]>
        </ts:abi>

	</ts:contract>
	<ts:origins>
		<!-- Define the contract which holds the token that the user will use -->
        <ts:ethereum contract="Token"/>
		<ts:ethereum contract="Points"/>
	</ts:origins>

    <!--Comparing with points=-1 didn't work when points is 0 so use a magic number-->
    <ts:selection name="dummyForcePointsToLoadAlwaysFalse" filter="points=999989999">
		<ts:label>
			<ts:string xml:lang="en">Force points attribute to be fetched so the `i` button has access to them without clicking a card action first</ts:string>
		</ts:label>
	</ts:selection>

    <ts:selection name="dummyForceDonationsToLoadAlwaysFalse" filter="donations=999989999">
		<ts:label>
			<ts:string xml:lang="en">Force donations attribute to be fetched so the `i` button has access to them without clicking a card action first</ts:string>
		</ts:label>
	</ts:selection>

	<ts:cards>
		<ts:viewContent name="common" xmlns="http://www.w3.org/1999/xhtml">
			<ts:include type="html" src="./dist/index.html"/>
			<ts:include type="css" src="./src/styles.css"/>
		</ts:viewContent>

        <ts:card type="action" name="QuickDonate" origins="Token" exclude="dummyForcePointsToLoadAlwaysFalse">
			<ts:label>
				<ts:string xml:lang="en">Quick Donate</ts:string>
			</ts:label>
            <ts:transaction>
                <ethereum:transaction contract="DonationManager" function="quickDonate" as="uint">
                    <ts:data>
                        <ts:uint256 ref="tokenId"/>
                    </ts:data>
                    <ethereum:value>1005000000000000</ethereum:value>
                </ethereum:transaction>
            </ts:transaction>
			<ts:view xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" urlFragment="quickDonate" uiButton="false">
				<ts:viewContent name="common"/>
			</ts:view>
		</ts:card>

		<ts:card type="action" name="DonateToCharity" origins="Token" exclude="dummyForceDonationsToLoadAlwaysFalse">
			<ts:label>
				<ts:string xml:lang="en">Donate to Charity</ts:string>
			</ts:label>
            <ts:transaction>
                <ethereum:transaction contract="DonationManager" function="donateETH" as="uint">
                    <ts:data>
                        <ts:uint256 ref="tokenId"/>
                        <ts:string local-ref="charity"/>
                    </ts:data>
                    <ethereum:value local-ref="amount"/>
                </ethereum:transaction>
            </ts:transaction>
			<ts:view xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" urlFragment="donateToCharity" uiButton="false">
				<ts:viewContent name="common"/>
			</ts:view>
		</ts:card>

		<ts:card type="action" name="WalletPass" origins="Token">
			<ts:label>
				<ts:string xml:lang="en">Show as QR</ts:string>
			</ts:label>
			<ts:view xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" urlFragment="walletPass" uiButton="false">
				<ts:viewContent name="common"/>
			</ts:view>
		</ts:card>

        <ts:card type="action" name="Vote" origins="Token">
            <ts:label>
                <ts:string xml:lang="en">Vote for Charity Fund Allocation</ts:string>
            </ts:label>
            <ts:view xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" urlFragment="vote" uiButton="false">
                <ts:viewContent name="common"/>
            </ts:view>
		</ts:card>

		<!--hhh3 leaderboard-->
<!--        <ts:card type="action" name="Leaderboard" origins="Token">-->
<!--            <ts:label>-->
<!--                <ts:string xml:lang="en">Leaderboard</ts:string>-->
<!--            </ts:label>-->
<!--            <ts:view xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" urlFragment="vote" uiButton="false">-->
<!--                <ts:viewContent name="common"/>-->
<!--            </ts:view>-->
<!--		</ts:card>-->

	</ts:cards>

	<ts:attribute name="points">
		<ts:type>
			<ts:syntax>1.3.6.1.4.1.1466.115.121.1.27</ts:syntax>
		</ts:type>
		<ts:label>
			<ts:string xml:lang="en">Charity Balance</ts:string>
		</ts:label>
		<ts:origins>
			<ethereum:call as="uint" contract="Points" function="balanceOf">
				<ts:data>
					<ts:address ref="ownerAddress"/>
				</ts:data>
			</ethereum:call>
		</ts:origins>
	</ts:attribute>

	<ts:attribute name="donations">
		<ts:type>
			<ts:syntax>1.3.6.1.4.1.1466.115.121.1.27</ts:syntax>
		</ts:type>
		<ts:label>
			<ts:string xml:lang="en">Donated</ts:string>
		</ts:label>
		<ts:origins>
			<ethereum:call as="uint" contract="DonationManager" function="donationByCardId">
				<ts:data>
                    <ts:uint256 ref="cardTokenId"/>
                    <ts:address>0x0000000000000000000000000000000000000000</ts:address>
				</ts:data>
			</ethereum:call>
		</ts:origins>
	</ts:attribute>

	<ts:attribute name="cardTokenId">
		<ts:type>
			<ts:syntax>1.3.6.1.4.1.1466.115.121.1.27</ts:syntax>
		</ts:type>
		<ts:label>
			<ts:string xml:lang="en">Card ID</ts:string>
		</ts:label>
		<ts:origins>
			<ethereum:call as="uint" contract="Token" function="tokenOfOwnerByIndex">
				<ts:data>
                    <ts:address ref="ownerAddress"/>
                    <ts:uint256>0</ts:uint256>
				</ts:data>
			</ethereum:call>
		</ts:origins>
	</ts:attribute>

</ts:token>
